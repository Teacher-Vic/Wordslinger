<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Wordslinger</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #faf9f6;
  padding: 20px;
  max-width: 600px;
  margin: auto;
  color: #222;
}
h1 { text-align: center; }
select, button {
  font-size: 16px;
  padding: 10px;
  margin: 8px 0;
  width: 100%;
}
.word-box {
  background: white;
  border-radius: 10px;
  padding: 18px;
  margin-top: 15px;
  box-shadow: 0 0 6px rgba(0,0,0,0.1);
}
.example {
  margin-left: 15px;
  opacity: 0.9;
}
.buttons {
  display: flex;
  justify-content: space-between;
  margin-top: 12px;
}
.buttons button {
  width: 48%;
}
</style>
</head>
<body>

<h1>Wordslinger</h1>

<label>Choose Level:</label>
<select id="level">
  <option value="beginner">Beginner</option>
  <option value="journey">Journey</option>
  <option value="advanced">Advanced</option>
  <option value="master">Master</option>
</select>

<div class="word-box" id="display"></div>

<div class="buttons">
  <button id="favBtn">Save Word</button>
  <button id="newBtn">New Word</button>
</div>

<script>
const words = {
  beginner: [
    "apple","happy","book","learn","friend","water","carry","sleep","slow","fast",
    "kind","bright","clean","cold","warm"
  ],
  journey: [
    "wander","gather","adjust","certain","encourage","avoid","attempt","confident",
    "delight","effort","include","maintain","brief","method","focus","unique",
    "recent","compare","express","respond"
  ],
  advanced: [],
  master: []
};

let history = JSON.parse(localStorage.getItem("history_words")) || [];
let favorites = JSON.parse(localStorage.getItem("favorite_words")) || [];
let currentWord = null;

// ✅ Natural fallback example generator
function makeExample(word, type) {
  const templates = {
    noun: [
      `I saw a ${word} today.`,
      `The ${word} was on the table.`,
      `She talked about the ${word} in class.`
    ],
    verb: [
      `I will ${word} later.`,
      `They decided to ${word} together.`,
      `Try to ${word} if you can.`
    ],
    adjective: [
      `The weather is very ${word} today.`,
      `She seems ${word} this morning.`,
      `That was a ${word} idea.`
    ],
    default: [
      `This is an example using the word "${word}".`
    ]
  };

  const group = templates[type] || templates.default;
  return group[Math.floor(Math.random() * group.length)];
}

// ✅ Improved dictionary fetch with multi-meaning example search
async function newWord() {
  const lvl = document.getElementById("level").value;
  const pool = words[lvl];
  const chosen = pool[Math.floor(Math.random() * pool.length)];

  const res = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${chosen}`);
  const data = await res.json();
  const entry = data[0];

  const meaning = entry.meanings[0];
  const definition = meaning.definitions[0].definition;
  const type = meaning.partOfSpeech;

  // Search *all* meanings & definitions for real examples
  let examples = [];
  entry.meanings.forEach(m => {
    m.definitions.forEach(d => {
      if (d.example) examples.push(d.example);
    });
  });

  // If still no examples → auto-generate 3 good ones
  if (examples.length === 0) {
    examples = [
      makeExample(entry.word, type),
      makeExample(entry.word, type),
      makeExample(entry.word, type)
    ];
  }

  currentWord = {
    word: entry.word,
    type,
    def: definition,
    ex: examples.slice(0, 3)
  };

  history.push(currentWord.word);
  localStorage.setItem("history_words", JSON.stringify(history));

  displayWord();
}

function displayWord() {
  const box = document.getElementById("display");
  box.innerHTML = `
    <strong>Word:</strong> ${currentWord.word}<br>
    <strong>Level:</strong> ${document.getElementById("level").value}<br>
    <strong>Part of Speech:</strong> ${currentWord.type}<br>
    <strong>Definition:</strong> ${currentWord.def}<br><br>
    <strong>Examples:</strong><br>
    ${currentWord.ex.map(e => `<div class="example">• ${e}</div>`).join("")}
  `;
}

document.getElementById("newBtn").onclick = newWord;

document.getElementById("favBtn").onclick = function(){
  if (!currentWord) return;
  if (!favorites.includes(currentWord.word)) favorites.push(currentWord.word);
  localStorage.setItem("favorite_words", JSON.stringify(favorites));
  alert("Saved! (Favorites are stored on this device)");
};
</script>

</body>
</html>
